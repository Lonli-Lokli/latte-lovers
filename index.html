<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="favicon.svg" type="image/svg" />
    <link rel="manifest" href="manifest.json" />
    <title>Coffee Bean Latte Compatibility Checker</title>

    <!-- OpenGraph Meta Tags -->
    <meta
      property="og:title"
      content="Coffee Bean Latte Compatibility Checker ‚òï"
    />
    <meta
      property="og:description"
      content="Not sure which coffee beans to use for lattes? Our tool helps you find the perfect coffee beans for milk-based drinks. Compare different coffee origins, processing methods, and roast levels to create the perfect latte at home or in your caf√©."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://latte-lovers.vercel.app" />
    <meta
      property="og:image"
      content="https://latte-lovers.vercel.app/og-image.png"
    />
    <meta
      property="og:image:alt"
      content="Coffee Bean Latte Compatibility Checker - Find the perfect coffee beans for your lattes"
    />

    <!-- Twitter Card Meta Tags -->
    <meta
      name="twitter:title"
      content="Coffee Bean Latte Compatibility Checker ‚òï"
    />
    <meta
      name="twitter:description"
      content="Not sure which coffee beans to use for lattes? Our tool helps you find the perfect coffee beans for milk-based drinks. Compare different coffee origins, processing methods, and roast levels to create the perfect latte at home or in your caf√©."
    />
    <meta
      name="twitter:image"
      content="https://latte-lovers.vercel.app/og-image.png"
    />

    <!-- Additional Meta Tags -->
    <meta
      name="description"
      content="Not sure which coffee beans to use for lattes? Our tool helps you find the perfect coffee beans for milk-based drinks. Compare different coffee origins, processing methods, and roast levels to create the perfect latte at home or in your caf√©."
    />
    <meta
      name="keywords"
      content="best coffee for lattes, coffee beans for milk drinks, which coffee is good for lattes, coffee bean guide, coffee selection guide, coffee and milk compatibility, best coffee beans for milk, coffee bean recommendations, coffee brewing guide, barista tips, coffee bean characteristics, coffee flavor guide, how to choose coffee beans, coffee bean comparison, coffee bean selection tool, coffee bean compatibility, coffee bean guide for lattes, best coffee for milk drinks, coffee bean recommendations for lattes, coffee bean selection for cafes, coffee bean guide for baristas, coffee bean characteristics guide, coffee bean flavor profile, coffee bean selection for milk drinks, coffee bean guide for home brewing"
    />
    <meta name="author" content="Lonli-Lokli" />

    <!-- Additional SEO Meta Tags -->
    <meta name="robots" content="index, follow" />
    <meta name="language" content="English" />
    <meta name="revisit-after" content="7 days" />
    <meta name="rating" content="general" />
    <meta name="distribution" content="global" />
    <meta name="category" content="Coffee Tools" />
    <meta name="coverage" content="Worldwide" />
    <meta name="target" content="all" />
    <meta name="HandheldFriendly" content="true" />
    <meta name="MobileOptimized" content="width" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Latte Lovers" />
    <link rel="apple-touch-icon" href="192x192.png" />
    <link rel="stylesheet" href="src/styles.scss" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="header-content">
          <h1>
            <span class="coffee-emoji">‚òï</span>Coffee Bean Latte Compatibility
          </h1>
          <p>Find the perfect coffee beans for your milk-based drinks</p>
        </div>
        <div class="header-buttons">
          <button class="theme-toggle" title="Toggle theme">
            <span id="themeIcon">‚òÄÔ∏è</span>
          </button>
          <a href="#" class="header-btn" id="contactBtn">üìß Contact</a>
          <a
            href="https://buymeacoffee.com/lonlilokliV"
            class="header-btn"
            target="_blank"
            >‚òï Buy Me a Coffee</a
          >
          <button id="installPWA" class="header-btn hidden">
            üì± Save to Phone
          </button>
        </div>
      </div>

      <!-- Tab Navigation -->
      <nav class="tab-navigation">
        <button class="tab-btn active" data-tab="checker">
          <span class="tab-icon">üîç</span>
          <span class="tab-label">Coffee Checker</span>
        </button>
        <button class="tab-btn" data-tab="top">
          <span class="tab-icon">üîù</span>
          <span class="tab-label">Leaders</span>
        </button>
      </nav>

      <!-- Content Container -->
      <div id="content-container" class="content-container">
        <div class="loading-spinner"></div>
      </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Get in Touch</h2>
          <span class="close">&times;</span>
        </div>
        <div class="modal-body">
          <form action="https://formsubmit.co/lonli.lokli@gmail.com" method="POST">
            <input type="hidden" name="_subject" value="New message from Latte Coffee Checker" />
            <input type="hidden" name="_captcha" value="false" />
            <input type="hidden" name="_next" value="#contact-success" />

            <div class="modal-form-group">
              <label for="contactName">Name *</label>
              <input type="text" id="contactName" name="name" required />
            </div>

            <div class="modal-form-group">
              <label for="contactEmail">Email *</label>
              <input type="email" id="contactEmail" name="email" required />
            </div>

            <div class="modal-form-group">
              <label for="contactMessage">Message *</label>
              <textarea
                id="contactMessage"
                name="message"
                placeholder="Tell us about your coffee experience or suggestions..."
                required
              ></textarea>
            </div>

            <button type="submit" class="modal-submit-btn">Send Message</button>
          </form>
        </div>
      </div>
    </div>

    <script type="module">
      import {
        toggleBlendInputs,
        validateBlend,
        checkCoffee,
        toggleTheme,
        openContactModal,
        closeContactModal,
        coffeeProfiles,
        processingMethods,
        generateAndRankLeaders,
        roastLevelEffects,
        initializeTooltips,
        initializeLeadersFilters,
      } from "./src/script.mjs";

      // Content cache
      const contentCache = new Map();
      let currentTab = 'checker';

      // Initialize country options
      function initializeCountryOptions() {
        const countrySelects = ["country", "blend1Country", "blend2Country"];
        const countries = Object.keys(coffeeProfiles).sort();

        countrySelects.forEach((selectId) => {
          const select = document.getElementById(selectId);
          if (select) {
            countries.forEach((country) => {
              const option = document.createElement("option");
              option.value = country;
              option.textContent = country
                .split("-")
                .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
                .join(" ");
              select.appendChild(option);
            });
          }
        });
      }

      // Initialize processing options
      function initializeProcessingOptions() {
        const processingSelect = document.getElementById("processing");
        if (processingSelect) {
          const methods = Object.entries(processingMethods);

          methods.forEach(([value, { displayName }]) => {
            const option = document.createElement("option");
            option.value = value;
            option.textContent = displayName;
            if (value === "washed") {
              option.selected = true;
            }
            processingSelect.appendChild(option);
          });
        }
      }

      // Load tab content
      async function loadTabContent(tabName) {
        const contentContainer = document.getElementById('content-container');
        if (!contentContainer) {
          console.error('Content container not found');
          return;
        }

        // Create loading spinner if it doesn't exist
        let spinner = contentContainer.querySelector('.loading-spinner');
        if (!spinner) {
          spinner = document.createElement('div');
          spinner.className = 'loading-spinner';
          contentContainer.appendChild(spinner);
        }

        // Show loading spinner
        spinner.classList.remove('hidden');

        try {
          let content;
          // Check cache first
          if (contentCache.has(tabName)) {
            content = contentCache.get(tabName);
          } else {
            // Dynamically import the HTML file using Vite
            const module = await import(`./src/${tabName}.html?raw`); // Use ?raw to import as a string
            content = module.default; // The HTML content will be the default export when using ?raw
            contentCache.set(tabName, content);
          }

          contentContainer.innerHTML = content;

          // Re-add spinner after setting innerHTML
          spinner = document.createElement('div');
          spinner.className = 'loading-spinner';
          contentContainer.appendChild(spinner);

          // Initialize elements and functionality based on tab content
          if (tabName === 'checker') {
            initializeCountryOptions();
            initializeProcessingOptions();

            // Add event listeners for the loaded content
            const coffeeTypeSelect = document.getElementById('coffeeType');
            if (coffeeTypeSelect) {
              coffeeTypeSelect.addEventListener('change', toggleBlendInputs);
            }

            const blend1Percent = document.getElementById('blend1Percent');
            const blend2Percent = document.getElementById('blend2Percent');
            if (blend1Percent && blend2Percent) {
              blend1Percent.addEventListener('input', validateBlend);
              blend2Percent.addEventListener('input', validateBlend);
            }

            const checkBtn = document.querySelector('.check-btn');
            if (checkBtn) {
              checkBtn.addEventListener('click', checkCoffee);
            }
          } else if (tabName === 'top') {
              // Initialize filters and populate table via filters
              initializeLeadersFilters(coffeeProfiles, processingMethods, roastLevelEffects);
          }

        } catch (error) {
          console.error('Error loading tab content:', error);
          contentContainer.innerHTML = '<div class="error">Failed to load content. Please try again.</div>';
        } finally {
          // Hide loading spinner
          spinner = contentContainer.querySelector('.loading-spinner');
          if (spinner) {
            spinner.classList.add('hidden');
          }
        }
      }

      // Handle tab switching
      function switchTab(tabName) {
        // Update active tab button
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.tab === tabName);
        });

        // Update URL hash
        window.location.hash = tabName;
        currentTab = tabName;

        // Load tab content
        loadTabContent(tabName);
      }

      // Initialize when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        // Add tab click handlers
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => switchTab(btn.dataset.tab));
        });

        // Handle hash changes
        window.addEventListener('hashchange', () => {
          const tabName = window.location.hash.slice(1) || 'checker';
          switchTab(tabName);
        });

        // Handle initial load
        const initialTab = window.location.hash.slice(1) || 'checker';
        switchTab(initialTab);

        // Theme toggle
        document.querySelector(".theme-toggle").addEventListener("click", toggleTheme);

        // Contact modal handlers
        document.getElementById("contactBtn").addEventListener("click", openContactModal);
        document.querySelector(".close").addEventListener("click", closeContactModal);
        window.addEventListener("click", (event) => {
          const modal = document.getElementById("contactModal");
          if (event.target === modal) {
            closeContactModal();
          }
        });

        // PWA Installation
        let deferredPrompt;
        const installButton = document.getElementById("installPWA");

        if (window.matchMedia("(display-mode: standalone)").matches) {
          installButton.classList.add("hidden");
        }

        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (isIOS) {
          installButton.classList.remove("hidden");
          installButton.addEventListener("click", () => {
            alert(
              'To install this app on your device, tap the Share button and then "Add to Home Screen"'
            );
          });
        } else {
          window.addEventListener("beforeinstallprompt", (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.classList.remove("hidden");
          });

          installButton.addEventListener("click", async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            deferredPrompt = null;
            installButton.classList.add("hidden");
          });
        }
      });
    </script>
  </body>
</html>
