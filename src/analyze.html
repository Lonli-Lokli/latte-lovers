<div class="formula-container">
  <div class="analyze-vertical-stages" id="analyze-stages-js"></div>
  <svg id="connection-svg"></svg>

  <div class="result" id="formula-result">
    <div class="result-header">
      <div class="result-main">
        <span class="result-emoji" id="formula-emoji"></span>
        <div class="result-grade" id="formula-grade"></div>
      </div>
      <div class="result-score" id="formula-score"></div>
    </div>
    <div class="result-description" id="formula-description"></div>
  </div>

  <div class="toggle-section">
    <div class="toggle-header">
      <h3>Scoring Breakdown</h3>
      <span class="toggle-icon" id="scoring-icon">▼</span>
    </div>
    <div class="toggle-content" id="scoring-content">
      <div class="content-inner">
        <div class="explanation">
          <h3>Formula Components</h3>
          <p>
            <strong>Base Score:</strong> Balance×0.3 + Body×0.3 + Sweetness×0.25
            + Acidity×0.2
          </p>
          <p>
            <strong>Penalties:</strong> -0.15×(Acidity-7) if Acidity > 7,
            -0.2×(Bitterness-6) if Bitterness > 6, -0.1×(6-Sweetness) if
            Sweetness < 6
          </p>
          <p>
            <strong>Current:</strong>
            <span id="score-breakdown"
              >7×0.3 + 6×0.3 + 5×0.25 + 5×0.2 = 85</span
            >
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="toggle-section">
    <div class="toggle-header">
      <h3>Processing Impact</h3>
      <span class="toggle-icon" id="processing-icon">▼</span>
    </div>
    <div class="toggle-content" id="processing-content">
      <div class="content-inner" id="processing-details">
        <!-- Dynamic processing impact details will be added here by JavaScript -->
      </div>
    </div>
  </div>

  <div class="toggle-section">
    <div class="toggle-header">
      <h3>Roasting Impact</h3>
      <span class="toggle-icon" id="roasting-icon">▼</span>
    </div>
    <div class="toggle-content" id="roasting-content">
      <div class="content-inner" id="roasting-details">
        <!-- Dynamic roasting impact details will be added here by JavaScript -->
      </div>
    </div>
  </div>

  <div class="toggle-section">
    <div class="toggle-header">
      <h3>Perfect Latte</h3>
    </div>
    <div class="toggle-content active" id="perfect-latte-content">
      <div class="content-inner">
        <div class="explanation">
          <h3>Milk Selection</h3>
          <p>For the milk component, consider the following:</p>
          <p>
            <strong>Type:</strong> Whole milk is preferred for its higher fat
            and protein content, which creates a creamy texture and stable
            microfoam. Semi-skimmed milk can be used for a lighter texture, but
            may produce less stable foam.
          </p>
          <p>
            <strong>Alternative Milks:</strong> Oat milk (barista edition) is
            the best plant-based option for lattes, as it steams well and
            provides a creamy mouthfeel. Choose barista versions for best
            results.
          </p>
          <p>
            <strong>Proteins:</strong> For excellent microfoam and texture, use
            milk with at least <strong>3.0g protein per 100ml</strong>. Most
            whole and semi-skimmed dairy milks meet this, while only barista oat
            milks approach this threshold.
          </p>
          <p>
            <strong>Sugars:</strong> For optimal sweetness and caramelization,
            use milk with at least
            <strong>4.5g sugar per 100ml</strong> (lactose or added sugars).
            This ensures good flavor balance and helps with milk browning during
            steaming.
          </p>
        </div>

        <div class="explanation">
          <h3>Coffee Selection</h3>
          <p>
            To achieve a high latte score, consider the following based on the
            formula:
          </p>
          <p>
            <strong>Bitterness (Ideally 6 or less):</strong> The formula
            penalizes bitterness above 6. Keeping bitterness low is crucial to
            avoid score reduction.
          </p>
          <p>
            <strong>Acidity (Ideally 7 or less):</strong> The formula penalizes
            acidity above 7. Acidity also only contributes positively up to a
            value of 7. Aim for moderate acidity to avoid penalties and get a
            positive contribution.
          </p>
          <p>
            <strong>Sweetness (Ideally 6 or more):</strong> The formula
            penalizes sweetness below 6. Higher sweetness values (up to 10)
            contribute positively to the score without an upper penalty.
          </p>
          <p>
            <strong>Body (Ideally 6 or more):</strong> Higher body values (up to
            10) contribute positively to the score. A body of 6 or more ensures
            a good positive contribution.
          </p>
          <p>
            <strong>Balance (Ideally 7 or more):</strong> Higher balance values
            (up to 10) contribute strongly to the score. A balance of 7 or more
            ensures a significant positive contribution.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
